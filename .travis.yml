sudo: required
language: clojure
addons:
  postgresql: '9.3'
deploy:
  provider: s3
  skip_cleanup: true
  bucket: "opetushallitus-docs"
  local_dir: schemadocs
  acl: public_read
  region: eu-west-1
  access_key_id: "$ARTIFACTS_KEY"
  secret_access_key:
    secure: CP+kfXmTBH61eO43916RgHij7GHokZ3JiugrTeInX2b3qFUWJJyu1lPKVH6hnfMKN829JjXJv657SF5kl6UD8viL/ft1VhJMO4ShWXoyhU2bzDo9BGcOYj1vviqkH095XoxDmeFdIcK68l7qG2Fc2o2D26q2TMN0VQGay9hSggx5RypK4sIBK9bVAh+xu+M5mewj2AOK7dPXzTPnpUVfteGcHXDgkKYfs44nPXLCcHuQ0TKaC6sQbmV7vZMtE0tkLPSjPwam9GiH15li1OotP8t29yEJv0X6zQfT3k5iG/qhgVUbLwG5385/oOWRtiTJt/J1QOvF8Uzn9KnOiHpnSS+dT1lAU6ro2s4IsB6LDRkM4Nec2GEBXrWbobwc6rYu9f1OcO+QsIIyr7VKoaOScyUBEJIWDKY5DbEozQqf++Byh4acfGaojY5UWO2bSjSOK2aBZXhC8FP9EcGW/YX5BeeP7NLsAjm1B7q1NiY7EAgTJL6t8aq/0m1s1nUwPbcO25cbpidAWUPLH0nWnvdk8+JzkKWWfgpkCwZBUG/UrUoXdbxbzB+E31EEtiehFeoFlnto5Jzgfx4oa44/Y86AI/pr36gqfj/wW0Kww2vfvPBJOa99utoEZG9CWMWNK6kcUn4vvK4fMwP4GuyjdA3QaZpJ5B2CO2dHfmp/vF/1cfU=
services:
- postgresql
before_install:
- cd ttk-db
before_script:
- psql --file=../env/db/dev.sql
script:
- lein run 'postgresql://ttk_adm:ttk-adm@127.0.0.1:5432/ttk' -u ttk_user --aituhaku-username
  aituhaku_user --clear -t
- cd ../db-docs
- generate-schemadocs.sh
after_script:
- ls -latr schemadocs
